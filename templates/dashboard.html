<!DOCTYPE html>
<html>

<head>
    <title>Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <!-- Link to Scroll Snap CSS -->
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/@snapscroll/stylesheet" />
    <!-- Link to Scroll Snap JS -->
    <script type="module" src="https://unpkg.com/@snapscroll/script@0.0.8" async></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|
    Jost:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style2.css') }}">
</head>

<body>
    <!-- ======= Header ======= -->
    <header id="header" class="fixed-top">
        <div class="container d-flex align-items-center">
            <a href="index.html" class="logo me-auto"><img src="static/logo.png" alt="Logo" class="img-fluid"></a>
            <nav>
                <a href="/logout" class="logout-btn">Logout</a>
            </nav>
        </div>
    </header>
    <!-- End Header -->
    <h1>Welcome to Your Dashboard, {{ user_data.spotify_username }}</h1>
    <img class="user-profile-image" src="{{ user_data.profile_image }}" alt="Profile Image">
    <div class="user-info">
        <p>Main ID: {{ user_data.main_id }}</p>
        <p>Join Date: {{ user_data.join_date }}</p>
    </div>
    <!-- Carousel for Top Tracks of the Week -->
    <h2>Top Tracks of the Week</h2>
    <div class="carousel-container">
        <div class="carousel">
            {% for track in user_data.top_tracks_week %}
            <div class="item" style="background-image: url({{track.album.images.0.url}})">
                <div>
                    <span class="ranking">No Ranking</span>
                    <img src="{{ track.album.images.0.url }}" alt="{{ track.name }}">
                </div>
                <h3 class="track-name">{{ track.name }}</h3>
                <p class="artist-name">{{ track.artists[0].name }}</p>
                <div class="spotify-player" data-uri="{{ track.uri }}"></div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Carousel for Top Tracks of the Month -->
    <h2>Top Tracks of the Month</h2>
    <div class="carousel-container">
        <div class="carousel">
            {% for track in user_data.top_tracks_month %}
            <div class="item" style="background-image: url({{track.album.images.0.url}})">
                <div>
                    <span class="ranking">No Ranking</span>
                    <img src="{{ track.album.images.0.url }}" alt="{{ track.name }}">
                </div>
                <h3 class="track-name">{{ track.name }}</h3>
                <p class="artist-name">{{ track.artists[0].name }}</p>
                <div class="spotify-player" data-uri="{{ track.uri }}"></div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Carousel for Top Tracks of All Time 
    <h2>Top Tracks of all Time</h2>
    <div class="carousel-container">
        <div class="carousel">
            {% for track in user_data.top_tracks_all_time %}
            <div class="item" style="background-image: url({{track.album.images.0.url}})">
                <div>
                    <span class="ranking">No Ranking</span>
                    <img src="{{ track.album.images.0.url }}" alt="{{ track.name }}">
                </div>
                <h3 class="track-name">{{ track.name }}</h3>
                <p class="artist-name">{{ track.artists[0].name }}</p>
                <div class="spotify-player" data-uri="{{ track.uri }}"></div>
            </div>
            {% endfor %}
        </div>
    </div>-->

    <!-- Carousel for Top Songs of the Week -->
    <h2>Top Songs of the Week</h2>
    <div class="carousel-container">
        <div class="carousel">
            {% for song in user_data.top_songs_week %}
            <div class="item">
                <img src="{{ song.album.images.0.url }}" alt="{{ song.name }}">
                <h3>{{ song.name }}</h3>
                <p>{{ song.artists[0].name }}</p>
                <div class="spotify-player" data-uri="{{ song.uri }}"></div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Carousel for Top Songs of All Time -->
    <h2>Top Songs of All Time</h2>
    <div class="carousel-container">
        <div class="carousel">
            {% for song in user_data.top_songs_all_time %}
            <div class="item">
                <img src="{{ song.album.images.0.url }}" alt="{{ song.name }}">
                <h3>{{ song.name }}</h3>
                <p>{{ song.artists[0].name }}</p>
                <div class="spotify-player" data-uri="{{ song.uri }}"></div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Carousel for Top Artists of the Week -->
    <h2>Top Artists of the Week</h2>
    <div class="carousel-container">
        <div class="carousel">
            {% for artist in user_data.top_artists_week %}
            <div class="item" style="background-image: url({{artist.images.0.url}})">
                <div>
                    <span class="ranking">No Ranking</span>
                    <img src="{{ artist.images.0.url }}" alt="{{ artist.name }}">
                </div>
                <h3 class="artist-name">{{ artist.name }}</h3>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Carousel for Top Artists of the Month -->
    <h2>Top Artists of the Month</h2>
    <div class="carousel-container">
        <div class="carousel">
            {% for artist in user_data.top_artists_month %}
            <div class="item">
                <img src="{{ artist.images.0.url }}" alt="{{ artist.name }}">
                <h3>{{ artist.name }}</h3>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Carousel for Top Artists of All Time -->
    <h2>Top Artists of All Time</h2>
    <div class="carousel-container">
        <div class="carousel">
            {% for artist in user_data.top_artists_all_time %}
            <div class="item">
                <img src="{{ artist.images.0.url }}" alt="{{ artist.name }}">
                <h3>{{ artist.name }}</h3>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Carousel for Top Playlists -->
    <h2>Top Playlists</h2>
    <div class="carousel-container">
        <div class="carousel">
            {% for playlist in user_data.top_playlists %}
            <div class="item">
                <img src="{{ playlist.image_url }}" alt="{{ playlist.name }}">
                <h3>{{ playlist.name }}</h3>
                <p>Owner: {{ playlist.owner }}</p>
                <div class="spotify-player" data-uri="{{ playlist.uri }}"></div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Carousel for Recommended Songs -->
    <h2>Recommended Songs</h2>
    <div class="carousel-container">
        <div class="carousel">
            {% for song in user_data.recommended_songs %}
            <div class="item">
                <img src="{{ song.album.images.0.url }}" alt="{{ song.name }}">
                <h3>{{ song.name }}</h3>
                <p>{{ song.artists[0].name }}</p>
                <div class="spotify-player" data-uri="{{ song.uri }}"></div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Carousel for Recommended Playlists -->
    <h2>Recommended Playlists</h2>
    <div class="carousel-container">
        <div class="carousel">
            {% for playlist in user_data.recommended_playlists %}
            <div class="item">
                <img src="{{ playlist.image_url }}" alt="{{ playlist.name }}">
                <h3>{{ playlist.name }}</h3>
                <p>Owner: {{ playlist.owner }}</p>
                <div class="spotify-player" data-uri="{{ playlist.uri }}"></div>
            </div>
            {% endfor %}
        </div>
    </div>

    <h2>Top Genres</h2>
    <div>
        <img src="data:image/png;base64,{{ chart_image }}" alt="Top Genres Chart">
    </div>

    {% if error_message %}
    <p>{{ error_message }}</p>
    {% endif %}

    <!-- Footer -->
    <!-- <footer>
      <div class="main-content">
        <div class="left box">
          <h2>About us</h2>
          <div class="content">
            <p>CodinNepal is a YouTube channel where you can learn web designing, web development, ui/ux designing, html css tutorial, hover animation and effects, javascript and jquery tutorial and related so on.</p>
            <div class="social">
              <a href="https://facebook.com/coding.np"><span class="fab fa-facebook-f"></span></a>
              <a href="#"><span class="fab fa-twitter"></span></a>
              <a href="https://instagram.com/coding.np"><span class="fab fa-instagram"></span></a>
              <a href="https://youtube.com/c/codingnepal"><span class="fab fa-youtube"></span></a>
            </div>
          </div>
        </div>
        <div class="center box">
          <h2>Address</h2>
          <div class="content">
            <div class="place">
              <span class="fas fa-map-marker-alt"></span>
              <span class="text">Birendranagar, Surkhet</span>
            </div>
            <div class="phone">
              <span class="fas fa-phone-alt"></span>
              <span class="text">+089-765432100</span>
            </div>
            <div class="email">
              <span class="fas fa-envelope"></span>
              <span class="text">abc@example.com</span>
            </div>
          </div>
        </div>
        <div class="right box">
          <h2>Contact us</h2>
          <div class="content">
            <form action="#">
              <div class="email">
                <div class="text">Email *</div>
                <input type="email" required>
              </div>
              <div class="msg">
                <div class="text">Message *</div>
                <textarea rows="2" cols="25" required></textarea>
              </div>
              <div class="btn">
                <button type="submit">Send</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="bottom">
        <center>
          <span class="credit">Created By <a href="https://www.codingnepalweb.com">CodingNepal</a> | </span>
          <span class="far fa-copyright"></span><span> 2020 All rights reserved.</span>
        </center>
      </div>
    </footer>-->
    <!-- Footer End -->

    <!-- Spotify Web Playback SDK -->
    <script src="https://sdk.scdn.co/spotify-player.js"></script>
    <script>
        // Initialize the Spotify Web Playback SDK
        window.onSpotifyWebPlaybackSDKReady = () => {
            const players = document.querySelectorAll('.spotify-player');
            players.forEach(player => {
                const uri = player.dataset.uri;
                new Spotify.Player({
                    name: 'Web Playback SDK Player',
                    getOAuthToken: callback => {
                        // Replace with your own access token or fetch it from the backend
                        const accessToken = "{{ session['token_info']['access_token'] }}";
                        callback(accessToken);
                    },
                    volume: 0.5
                }).connect().then(success => {
                    if (success) {
                        // Load the specified track/playlist into the player
                        player.querySelector('iframe').src = `https://open.spotify.com/embed/${uri}`;
                    }
                });
            });
        };
    </script>
</body>

</html>